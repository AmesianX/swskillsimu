var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,b={next:function(){if(e<a.length){var d=e++;return{value:c(d,a[d]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill=function(a,c,e,b){if(c){e=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var d=a[b];d in e||(e[d]={});e=e[d]}a=a[a.length-1];b=e[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var c_maxlevel=60;
function SkillTreeCore(){this._spleft=this._investedsp=this._currentlevel=this._totalsp=0;this.slotassign=new SlotGrid}SkillTreeCore.prototype.GetTotalSP=function(){return this._totalsp};SkillTreeCore.prototype.GetCurrentLevel=function(){return this._currentlevel};SkillTreeCore.prototype.GetInvestedSP=function(){return this._investedsp};SkillTreeCore.prototype.GetSPLeft=function(){return this._spleft};
SkillTreeCore.prototype.SetLevel=function(a){this._currentlevel=Math.min(a,window.c_maxlevel);this._totalsp=this.inner_gettotalsp(this._currentlevel);this.UpdateAllSPs()};SkillTreeCore.prototype.SetLevelFromElement=function(){this.SetLevel(parseInt($("#selectLevelBox").val()))};
SkillTreeCore.prototype.UpdateSP=function(){this._spleft=this._totalsp-this._investedsp;5>this._spleft?$("#e_remainingSP").addClass("alertlow"):$("#e_remainingSP").removeClass("alertlow");$("#e_investedSP").text("Invested SP: "+this._investedsp+"/"+this._totalsp);$("#e_remainingSP").text("Remaining SP: "+this._spleft+"/"+this._totalsp);$("#spusageinfo").html(this.GenerateUsageInfo())};
SkillTreeCore.prototype.UpdateAllSPs=function(){$("#e_investedSP").text("Invested SP: "+this._investedsp+"/"+this._totalsp);this.CheckAllSkills()&&(this._spleft=this._totalsp-this._investedsp,$("#e_remainingSP").text("Remaining SP: "+this._spleft+"/"+this._totalsp),this.CheckAllSkills(),5>this._spleft?$("#e_remainingSP").addClass("alertlow"):$("#e_remainingSP").removeClass("alertlow"));$("#spusageinfo").html(this.GenerateUsageInfo())};SkillTreeCore.prototype.UnlearnAllSkills=function(){for(var a in this.SkillList)this.SkillList[a].UnlearnSkill()};
SkillTreeCore.prototype.CheckAllSkills=function(){if(this._totalsp<this._investedsp){if(this.SkillList)for(var a in this.SkillList)this.SkillList[a].UnlearnSkill();return!1}if(!this.SkillList)return!1;for(a in this.SkillList){var c=this.SkillList[a];if(c.GetAvailableLevel()>this._currentlevel)c.UnlearnSkill();else{c.GetCurrentSkillLevel()<c.GetDefaultLevel()&&c.UnlearnSkill();var e=c.CurrentLevelInfo();e.RequiredLevel>this._currentlevel&&c.UnlearnSkill()}}return!0};
SkillTreeCore.prototype.inner_gettotalsp=function(a){for(var c=0,e=1;e<=a;e++)c+=this.inner_gettotalspex(e);return c};
SkillTreeCore.prototype.inner_gettotalspex=function(a){switch(a){case 0:return 0;case 1:return 0;case 2:return 0;case 3:return 0;case 4:return 1;case 5:return 3;case 6:return 1;case 7:return 1;case 8:return 1;case 9:return 1;case 10:return 5;case 15:return 5;case 20:return 10;case 25:return 5;case 30:return 5;case 35:return 5;case 40:return 10;case 45:return 5;case 50:return 5;case 55:return 5;case 60:return 5;default:return 2}};
SkillTreeCore.prototype.GenerateLink=function(a){var c=[];this._currentlevel!==window.c_maxlevel&&c.push("lv="+this._currentlevel);for(var e in this.SkillList){var b=this.SkillList[e].GetCurrentSkillLevel();b!=this.SkillList[e].GetDefaultLevel()&&(this.SkillList[e].ShortID?c.push(this.SkillList[e].ShortID+"="+b):c.push(e+"="+b))}e=location.protocol+"//"+location.host+location.pathname;b=null;var d=this.slotassign.GenerateAssignment();d&&c.push("s="+d);"2_1"!==this.slotassign.effect2nd&&c.push("b1="+
this.slotassign.effect2nd);"3_1"!==this.slotassign.effect3rd&&c.push("b2="+this.slotassign.effect3rd);!0===a&&c.push("sa=1");1<c.length?b=c.join("&"):1===c.length&&(b=c[0]);b&&(e=e+"?"+b);return e};
SkillTreeCore.prototype.GenerateUsageInfo=function(){var a={},c;for(c in this.SkillList)if(this.SkillList.hasOwnProperty(c)&&this.SkillList[c].GetCurrentSkillLevel()!=this.SkillList[c].GetDefaultLevel()){var e=this.SkillList[c].GetSPUsed();var b=this.SkillList[c].GetParent();0!=e&&(b?a[b.GetID()]+=" + "+e+"SP":a[c]=this.SkillList[c].GetName()+": "+e+"SP")}b="";e=!0;if(0<Object.keys(a).length)for(c in a)a.hasOwnProperty(c)&&(e?(b+=a[c],e=!1):b+="<br>"+a[c]);return b};
SkillTreeCore.prototype.ResetSlotAssignment=function(){this.slotassign.ResetToEmpty()};SkillTreeCore.prototype.SetSkillAssignment=function(a,c,e){this.slotassign.SetGridValue(a,c,e)};SkillTreeCore.prototype.GetSkillAssignmentRender=function(){return this.slotassign.GetRender()};SkillTreeCore.prototype.ReadAssignment=function(){this.slotassign.ReadAssignment()};var SkillCore=new SkillTreeCore,mouseX,mouseY;$(document).mousemove(function(a){window.mouseX=a.pageX;window.mouseY=a.pageY});
function SetToolTip(a){var c;a.mouseover(function(){var a=$(this).attr("insight");if(a){var b=window.SkillCore.GetSkill(a);if(a=b.GetCurrentLevelInfo()){var d=a.SkillDescription,f=a.SkillEffect;a=$("div#tooltip");var g=[];d&&(g.push("[Description]\n"),g.push(d));f&&(0!==g.length&&g.push("\n\n"),g.push("[Effect]\n"),g.push(f));$("div#tooltip .tooltipheader").text(b.GetName());0!==g?$("div#tooltip pre").text(g.join("")).show():$("div#tooltip pre").empty().hide();b={};c=$(".navbar.fixed-bottom").outerHeight(!0);
d=window.mouseY+10;d+a.outerHeight(!0)>$(document).height()-c?(b.bottom=c,b.top=""):(b.bottom="",b.top=d);d=window.mouseX+5;d+a.outerWidth(!0)>$(document).width()?(b.left="",b.right=0):(b.right="",b.left=d);a.css(b);a.stop(!1,!0).fadeIn("fast")}}}).mousemove(function(){var a=$("div#tooltip"),b={},d=window.mouseY+10;d+a.outerHeight(!0)>$(document).height()-c?(b.bottom=c,b.top=""):(b.bottom="",b.top=d);d=window.mouseX+5;d+a.outerWidth(!0)>$(document).width()?(b.left="",b.right=0):(b.right="",b.left=
d);a.css(b)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}
function SetToolTipUp(a){var c;a.mouseover(function(){var a=$(this).attr("insight");if(a){a=window.SkillCore.GetSkill(a);var b=a.GetCurrentLevelInfo(),d=a.GetNextLevelInfo();a=$("div#tooltip");if(b||d){b=b.SkillEffect;var f="";d&&(f=d.SkillEffect);b||f?(d=[],b&&(d.push("[Current]\n"),d.push(b)),f&&(0!==d.length&&d.push("\n\n"),d.push("[After]\n"),d.push(f)),0!==d.length?$("div#tooltip pre").text(d.join("")).show():$("div#tooltip pre").empty().hide(),d={},c=$(".navbar.fixed-bottom").outerHeight(!0),
b=window.mouseY+10,b+a.outerHeight(!0)>$(document).height()-c?(d.bottom=c,d.top=""):(d.bottom="",d.top=b),b=window.mouseX+5,b+a.outerWidth(!0)>$(document).width()?(d.left="",d.right=0):(d.right="",d.left=b),a.css(d),a.stop(!1,!0).fadeIn("fast")):a.stop(!1,!0).fadeOut("fast")}}}).mousemove(function(){var a=$("div#tooltip"),b={},d=window.mouseY+10;d+a.outerHeight(!0)>$(document).height()-c?(b.bottom=c,b.top=""):(b.bottom="",b.top=d);d=window.mouseX+5;d+a.outerWidth(!0)>$(document).width()?(b.left="",
b.right=0):(b.right="",b.left=d);a.css(b)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}
function SetToolTipDown(a){var c;a.mouseover(function(){var a=$(this).attr("insight");if(a){a=window.SkillCore.GetSkill(a);var b=a.GetCurrentLevelInfo(),d=a.GetPreviousLevelInfo();a=$("div#tooltip");if(b||d){b=b.SkillEffect;var f="";d&&(f=d.SkillEffect);b||f?(d=[],b&&(d.push("[Current]\n"),d.push(b)),f&&(0!==d.length&&d.push("\n\n"),d.push("[After]\n"),d.push(f)),0!==d.length?$("div#tooltip pre").text(d.join("")).show():$("div#tooltip pre").empty().hide(),d={},c=$(".navbar.fixed-bottom").outerHeight(!0),
b=window.mouseY+10,b+a.outerHeight(!0)>$(document).height()-c?(d.bottom=c,d.top=""):(d.bottom="",d.top=b),b=window.mouseX+5,b+a.outerWidth(!0)>$(document).width()?(d.left="",d.right=0):(d.right="",d.left=b),a.css(d),a.stop(!1,!0).fadeIn("fast")):a.stop(!1,!0).fadeOut("fast")}}}).mousemove(function(){var a=$("div#tooltip"),b={},d=window.mouseY+10;d+a.outerHeight(!0)>$(document).height()-c?(b.bottom=c,b.top=""):(b.bottom="",b.top=d);d=window.mouseX+5;d+a.outerWidth(!0)>$(document).width()?(b.left="",
b.right=0):(b.right="",b.left=d);a.css(b)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}function ShowDangerDialog(a,c,e){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Warning",Bootstrap4ModalDialog.ButtonsYesNoDanger);a.RegisterCallback(function(a,d){d?"function"===typeof c&&c():"function"===typeof e&&e()});a.Show()}
function ShowMessageDialog(a,c){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Notice");a.RegisterCallback(function(a,b){b&&"function"===typeof c&&c()});a.Show()}function ShowConfirmDialog(a,c,e){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Double confirmation",Bootstrap4ModalDialog.ButtonsYesNo);a.RegisterCallback(function(a,d){d?"function"===typeof c&&c():"function"===typeof e&&e()});a.Show()}
function ShowSkillAssignment(a){window.SkillCore&&(new Bootstrap4ModalDialog($("#dialogs"),window.SkillCore.GetSkillAssignmentRender(),"Skill slot assignment",[{label:"Reset",cssClass:"btn btn-warning",action:function(a){window.ShowDangerDialog("Are you sure you want to reset all the slot assignments?",function(){window.SkillCore.ResetSlotAssignment()})}},{label:"Close",cssClass:"btn btn-default",action:function(c){c.Hide();"function"===typeof a&&a()}}])).Show()}
$(function(){$("#dialogs").hide().click(function(a){a.preventDefault();window.DialogManager.CloseForegroundDialog()});window.DialogManager.OnModalChanged(function(a){a?$("#dialogs").show():$("#dialogs").hide()});SetLoading($("body"));for(var a=$('<select id="selectLevelBox">').change(function(){window.SkillCore.SetLevel($(this).val())}),c=1;c<=window.c_maxlevel;c++)a.append($("<option>").val(c).text(c));$("#levelBoxtd").append(a);c=GetUrlParam("lv",60);60==c&&(c=GetUrlParam("level",60));isNaN(c)&&
(c=60);a.val(c);a.trigger("change");$('#charList a[href^="../'+GetCurrentFolderUrl()+'"]').remove();$("#copyURL").click(function(a){a.preventDefault();(a=window.SkillCore.GenerateLink())&&copyLink(a)});$("#copyURLshowassign").click(function(a){a.preventDefault();(a=window.SkillCore.GenerateLink(!0))&&copyLink(a)});$("#resetAllSkill").click(function(){ShowDangerDialog("Are you sure you want to unlearn all skills?",function(){window.SkillCore.UnlearnAllSkills()})});$("#slotassignment").click(function(){ShowSkillAssignment()});
var e=GetUrlParam("sa",null);window.SkillCore.ReadTree(function(a){if(a.Cover&&a.Cover.URL){var b=a.Cover.Position?a.Cover.Position:"side-right";$("#forbackground").append($("<img>").addClass(["image-bg-character",b]).attr("src",a.Cover.URL).imagesLoaded().always(function(a){a.elements.forEach(function(a,b,c){$(a).addClass("animated fadeIn").show()})}).hide())}},function(){RemoveLoading($("body"));window.SkillCore.ReadAssignment();"1"===e&&$("#slotassignment").click()})});
