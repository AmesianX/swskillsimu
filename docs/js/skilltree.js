SkillTreeCore.prototype.ReadTree=function(a,b){this.SkillList={};this.ActiveSkillList={};this.PassiveSkillList={};this.loadedSkillCount=this.SkillCount=0;$.ajax({cache:!1,url:"skilltreeinfo.json",dataType:"json",success:function(c){c.CharacterName?$("#charName").text(c.CharacterName):$("#charName").text(GetCurrentFolderUrl());c.CharacterWikiURL?c.CharacterName?$("#morecharacterinfo").attr("href",c.CharacterWikiURL).attr("target","_blank").text("More info about "+c.CharacterName):$("#morecharacterinfo").attr("href",
c.CharacterWikiURL).attr("target","_blank").text("More info about "+GetCurrentFolderUrl()):$("#morecharacterinfo").remove();window.document.title="Skill Simulator - "+c.CharacterName;for(var d in c.Skills)c.Skills.hasOwnProperty(d)&&(window.SkillCore.SkillList[d]=new SkillInfo(d,c.Skills[d].Name,c.Skills[d]),window.SkillCore.SkillList[d].IsPassive()?window.SkillCore.PassiveSkillList[d]=window.SkillCore.SkillList[d]:window.SkillCore.ActiveSkillList[d]=window.SkillCore.SkillList[d]);window.SkillCore.SkillCount=
Object.keys(window.SkillCore.SkillList).length;"function"===typeof a&&a(c);window.SkillCore.RenderTree(b)}})};SkillTreeCore.prototype.GetSkill=function(a){return this.SkillList[a]};SkillTreeCore.prototype.GetSkillByShortID=function(a){for(var b in this.SkillList)if(this.SkillList.hasOwnProperty(b)&&this.SkillList[b].ShortID&&this.SkillList[b].ShortID==a)return this.SkillList[b];return null};
SkillTreeCore.prototype.RenderTree=function(a){var b=$("li#activeskill");if(b){var c=$("<ul>").addClass("tableactiveskill");b.empty();var d=0,e;for(e in this.ActiveSkillList)this.ActiveSkillList[e].IsVisible()&&(1<this.ActiveSkillList[e].GetRowSpan()?d+=this.ActiveSkillList[e].GetRowSpan():d++,c.append($("<li>").addClass("tablelike").append(this.ActiveSkillList[e].GetSkillPanel())),3<=d&&(c&&b.append(c),c=$("<ul>").addClass("tableactiveskill"),d=0));0<d&&c&&b.append(c)}if(b=$("li#passiveskill")){c=
$("<ul>").addClass("tablepassiveskill");b.empty();d=0;for(e in this.PassiveSkillList)this.PassiveSkillList[e].IsVisible()&&(1<this.PassiveSkillList[e].GetRowSpan()?d+=this.PassiveSkillList[e].GetRowSpan():d++,c.append($("<li>").addClass("tablelike").addClass("passiveskilltree").append(this.PassiveSkillList[e].GetSkillPanel())),2<=d&&(c&&b.append(c),c=$("<ul>").addClass("tablepassiveskill"),d=0));0<d&&c&&b.append(c)}"function"===typeof a&&$("#skilltree").imagesLoaded().always(function(){a()})};
SkillInfo.prototype.GetSkillPanel=function(a){if(this.Panel)return this.Panel;if(a){a=$("<div>").addClass("skillExinfopanel").addClass("fadeinAppear");a.attr("insight",this._id);a.css({top:""});var b=$("<img>").addClass("skillExIcon").attr("insight",this._id).attr("src",this.GetIconURL());a.append(b);SetToolTip(b);b=$('<button type="button" class="btn-success skillexup" insight="'+this._id+'">').attr("skillup","1");this._currentskilllevel===this._skillmaxlevel&&b.addClass("disabled");SetToolTipUp(b);
a.append(b.click(function(){$(this).hasClass("disabled")||(window.SkillCore.GetSkill($(this).attr("insight")).SkillUp(),$(this).trigger("mouseover"))}));b=$('<button type="button" class="btn-danger skillexdown" insight="'+this._id+'">').attr("skilldown","1");this._currentskilllevel===this._defaultLevel&&b.addClass("disabled");SetToolTipDown(b);a.append(b.click(function(){$(this).hasClass("disabled")||(window.SkillCore.GetSkill($(this).attr("insight")).SkillDown(),$(this).trigger("mouseover"))}));
a.append($('<p insight="skilllexevel">').addClass("skillExLevel").text(this._currentskilllevel+""+this._skillmaxlevel));b=this.GetExtensions();if(void 0!==b&&0<Object.keys(b).length){var c;for(c in b){var d=window.SkillCore.GetSkill(c);d.GetSkillPanel(!0).appendTo(a)}}}else if(a=$("<div>").addClass("skillinfopanel").addClass("fadeinAppear"),a.attr("insight",this._id),b=$("<img>").addClass("skillIcon").attr("insight",this._id).attr("src",this.GetIconURL()),a.append(b),SetToolTip(b),b=$('<button type="button" class="btn btn-success skillup" insight="'+
this._id+'">').attr("skillup","1"),this._currentskilllevel===this._skillmaxlevel&&b.addClass("disabled"),SetToolTipUp(b),a.append(b.click(function(){window.SkillCore.GetSkill($(this).attr("insight")).SkillUp();$(this).trigger("mouseover")})),b=$('<button type="button" class="btn btn-danger skilldown" insight="'+this._id+'">').attr("skilldown","1"),this._currentskilllevel===this._defaultLevel&&b.addClass("disabled"),SetToolTipDown(b),a.append(b.click(function(){window.SkillCore.GetSkill($(this).attr("insight")).SkillDown();
$(this).trigger("mouseover")})),a.append($('<p insight="skilllevel">').addClass("skillLevel").text(this._currentskilllevel+"/"+this._skillmaxlevel)),b=this.GetExtensions(),void 0!==b&&0<Object.keys(b).length){var e=!1,f=0;for(c in b){f++;var g=$("<div>").addClass("extension"+f+"infopanel");d=window.SkillCore.GetSkill(c);d.GetSkillPanel(!0).appendTo(g);this._currentskilllevel<this._skillmaxlevel?d.Disabled(!0):0<d.GetCurrentSkillLevel()?(d.Disabled(!1),e=!0):d.Disabled(!0);g.appendTo(a)}if(!e&&this._currentskilllevel==
this._skillmaxlevel)for(c in b)window.SkillCore.GetSkill(c).Disabled(!1)}return this.Panel=a};
SkillInfo.prototype.Disabled=function(a){a?(this.UnlearnSkill(),a=this.GetSkillPanel(),a.hasClass("disabled")||a.addClass("disabled"),a.find("button[skilldown]:not(.disabled)").addClass("disabled"),a.find("button[skillup]:not(.disabled)").addClass("disabled"),a.find("img:not(.disabled)").addClass("disabled")):(a=this.GetSkillPanel(),a.hasClass("disabled")&&a.removeClass("disabled"),a.find("img.disabled").removeClass("disabled"),a.find("button.disabled[skilldown]").removeClass("disabled"),a.find("button.disabled[skillup]").removeClass("disabled"))};
SkillInfo.prototype.UpdateSkill=function(){if(this.Panel){var a=this.Panel;a.children('p[insight="skilllevel"]:first').text(this._currentskilllevel+"/"+this._skillmaxlevel);a.children('p[insight="skilllexevel"]:first').text(this._currentskilllevel+""+this._skillmaxlevel);if(this._currentskilllevel<=this._defaultLevel){if(a.children("button[skilldown]:first").addClass("disabled"),(a=this._parent)&&!a.GetNextLevelInfo()){a=a.GetExtensions();for(var b in a)a[b].Disabled(!1)}}else if(this._currentskilllevel==
this._skillmaxlevel){a.children("button[skillup]:first").addClass("disabled");if(a=this._parent)for(b in a=a.GetExtensions(),a){var c=a[b];c.GetID()!==this._id&&c.Disabled(!0)}a=this.GetExtensions();for(b in a)a[b].Disabled(!1)}else{a.children("button.disabled[skilldown]:first").removeClass("disabled");a.children("button.disabled[skillup]:first").removeClass("disabled");if(a=this._parent)for(b in a=a.GetExtensions(),a)c=a[b],c.GetID()!==this._id&&c.Disabled(!0);a=this.GetExtensions();for(b in a)a[b].Disabled(!0)}}};
SkillInfo.prototype.SkillUp=function(){var a=this.GetNextLevelInfo();a&&(a.RequiredLevel>window.SkillCore.GetCurrentLevel()?shownotify("Character level is not enough to learn further.","info"):(a=a.RequiredSP,window.SkillCore.GetSPLeft()<a?shownotify("Insufficient skill point.","info"):(this._currentskilllevel++,this._spused+=a,window.SkillCore.InvestedSPIncrease(a),this.UpdateSkill())))};
SkillInfo.prototype.SkillDown=function(){if(this.GetPreviousLevelInfo())if(this._defaultLevel===this._currentskilllevel)shownotify("Can not go lower than skill's default level.","warning");else{var a=this.GetCurrentLevelInfo().RequiredSP;this._spused-=a;window.SkillCore.InvestedSPDecrease(a);this._currentskilllevel--;this.UpdateSkill()}};
SkillInfo.prototype.SkillDownEx=function(){this.GetPreviousLevelInfo()&&(window.SkillCore.InvestedSPDecrease(this.GetCurrentLevelInfo().RequiredSP),this._currentskilllevel--,this.UpdateSkill())};SkillTreeCore.prototype.InvestedSPIncrease=function(a){this._investedsp+=a;this.UpdateSP()};SkillTreeCore.prototype.InvestedSPDecrease=function(a){this._investedsp-=a;this.UpdateSP()};