var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var f=a[e];if(b.call(d,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var e=d++;return{value:b(e,a[e]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
function ShowSkillSelection(a,b,d){window.SkillCore&&(d=[{label:"Select",cssClass:"btn btn-success",action:function(a){a.Hide();"function"===typeof b&&b(a.GetData("selectedskillid"))}}],a&&d.push({label:"Remove",cssClass:"btn btn-danger",action:function(a){a.Hide();"function"===typeof b&&b(null)}}),d.push({label:"Cancel",cssClass:"btn btn-default",action:function(a){a.Hide();"function"===typeof noCallback&&noCallback()}}),(new Bootstrap4ModalDialog($("#dialogs"),function(a){var d=$("<div>").addClass("container"),
c;for(c in window.SkillCore.ActiveSkillList)window.SkillCore.ActiveSkillList.hasOwnProperty(c)&&window.SkillCore.ActiveSkillList[c].IsVisible()&&window.SkillCore.ActiveSkillList[c].IsAssignable()&&0<window.SkillCore.ActiveSkillList[c].GetCurrentSkillLevel()&&d.append($("<div>").addClass("row").append($("<div>").addClass("col").append($("<button>").attr("type","button").addClass("btn btn-primary btn-block").append($("<div>").addClass(["clickthrough","row","text-noselect"]).append([$("<div>").addClass("col-md-auto").append($("<img>").attr("src",
window.SkillCore.ActiveSkillList[c].GetIconURL())),$("<div>").addClass("col").text(window.SkillCore.ActiveSkillList[c].GetName()),$("<div>").addClass("col col-lg-2").text("Lv: "+window.SkillCore.ActiveSkillList[c].GetCurrentSkillLevel()+"/"+window.SkillCore.ActiveSkillList[c].GetMaxLevel())])))).click(function(b){b.stopPropagation();d.find("button.active").removeClass(["btn-success","active"]).addClass("btn-primary");$(this).find("button").removeClass("btn-primary").addClass("active btn-success");
a.SetData("selectedskillid",$(this).attr("skillid"))}).dblclick(function(d){d.stopPropagation();a.Hide();"function"===typeof b&&b($(this).attr("skillid"))}).attr("skillid",c));return $("<div>").addClass("skill-list-select").append(d)},"Select skill to assign",d)).Show())}function GridInfo(){this.IsEmpty=!0;this.myDiv=this.SkillInfo=null}
GridInfo.prototype.Redraw=function(){this.myDiv&&(this.myDiv.empty(),this.IsEmpty?(this.myDiv.append($("<img>").addClass("clickthrough").attr("src","../skillicons/skillslot_empty_null.png")),this.myDiv.attr("title","Click the box to select skill")):(this.myDiv.append($("<img>").addClass("clickthrough").attr("src",this.SkillInfo.GetIconURL())),this.myDiv.attr("title","Skill: "+this.SkillInfo.GetName()+"\nClick the box to select skill")))};
GridInfo.prototype.resetinfo=function(){this.IsEmpty=!0;this.SkillInfo=null};GridInfo.prototype.SetSkill=function(a){a?(this.IsEmpty=!1,this.SkillInfo=a):this.resetinfo();this.Redraw()};GridInfo.prototype.UnsetSkill=function(){this.SetSkill(null)};
GridInfo.prototype.GetRender=function(){var a=this;this.myDiv=$("<div>").addClass("slotskillimg").click(function(b){b.preventDefault();ShowSkillSelection(!a.IsEmpty,function(b){b?a.SetSkill(window.SkillCore.SkillList[b]):a.UnsetSkill()})});this.IsEmpty||0===this.SkillInfo.GetCurrentSkillLevel()&&this.resetinfo();this.IsEmpty?(this.myDiv.append($("<img>").addClass("clickthrough").attr("src","../skillicons/skillslot_empty_null.png")),this.myDiv.attr("title","Click the box to select skill")):(this.myDiv.append($("<img>").addClass("clickthrough").attr("src",
this.SkillInfo.GetIconURL())),this.myDiv.attr("title","Skill: "+this.SkillInfo.GetName()+"\nClick the box to select skill"));return this.myDiv};function SlotGrid(){this.effect2nd="2_1";this.effect3rd="3_1";this.Column=[];this.Column[0]=this.initRow();this.Column[1]=this.initRow();this.Column[2]=this.initRow();this.Column[3]=this.initRow();this.Column[4]=this.initRow();this.Column[5]=this.initRow()}SlotGrid.prototype.getoption=function(a,b){return $("<option>").val(a).text(b)};
SlotGrid.prototype.initRow=function(){var a=[];a[0]=new GridInfo;a[1]=new GridInfo;a[2]=new GridInfo;return a};SlotGrid.prototype.IsEmptyColumn=function(a){for(var b=0;b<this.Column[a].length;b++)if(!this.GetGridValue(a,b).IsEmpty)return!1;return!0};SlotGrid.prototype.IsEmptyTree=function(){for(var a=0;a<this.Column.length;a++)if(!this.IsEmptyColumn(a))return!1;return!0};SlotGrid.prototype.ResetToEmpty=function(){for(var a=0;a<this.Column[0].length;a++)for(var b=0;b<this.Column.length;b++)this.Column[b][a].UnsetSkill()};
SlotGrid.prototype.GetGridValue=function(a,b){return this.Column[a][b]};SlotGrid.prototype.SetGridValue=function(a,b,d){this.Column[a][b].SetSkill(d)};SlotGrid.prototype.UnsetGridValue=function(a,b){this.Column[a][b].UnsetSkill()};SlotGrid.prototype.printfloor=function(a){for(var b=[],d=0;d<a.length;d++)b.push($("<div>").addClass("col").append(a[d]));return b};SlotGrid.prototype.generatefloor=function(){for(var a=[],b=0;b<this.Column[0].length;b++){a[b]=[];for(var d=0;d<this.Column.length;d++)a[b].push(this.Column[d][b].GetRender())}return a};
SlotGrid.prototype.GetRender=function(){var a=this.generatefloor(),b=this;return $("<div>").append($("<ul>").addClass("liststyle-none").append([$("<li>").append($("<div>").addClass("row").append(this.printfloor(a[0]))),$("<li>").append($("<i>").addClass("fas fa-arrow-up")),$("<li>").append($("<span>").text("Step-3 Bonus: "),$("<select>").attr("id","select3rdchaineffect").append([this.getoption("3_1","Damage +8%"),this.getoption("3_2","Cooldown -15%"),this.getoption("3_3","SG cost -25%")]).val(b.effect3rd).change(function(){b.effect3rd=
$(this).val()})),$("<li>").append($("<i>").addClass("fas fa-arrow-up")),$("<li>").append($("<div>").addClass("row").append(this.printfloor(a[1]))),$("<li>").append($("<i>").addClass("fas fa-arrow-up")),$("<li>").append($("<span>").text("Step-2 Bonus: "),$("<select>").attr("id","select2ndchaineffect").append([this.getoption("2_1","Damage +4%"),this.getoption("2_2","Cooldown -8%"),this.getoption("2_3","SG cost -12%")]).val(b.effect2nd).change(function(){b.effect2nd=$(this).val()})),$("<li>").append($("<i>").addClass("fas fa-arrow-up")),
$("<li>").append($("<div>").addClass("row").append(this.printfloor(a[2]))),$("<li>").append($("<span>").text("(Click the boxes to assign skill)"))]))};
SlotGrid.prototype.ReadAssignment=function(){var a,b=GetUrlParam("s",null);if(b)for(b=b.split("_"),a=0;a<b.length;a++){var d=b[a].split("-");var c=window.SkillCore.GetSkillByShortID(d[2]);c||(c=window.SkillCore.GetSkill(d[2]));c&&!c.IsPassive()&&c.IsVisible()&&!0===c.IsAssignable()&&0<c.GetCurrentSkillLevel()&&this.Column[d[0]][d[1]].SetSkill(c)}d=GetUrlParam("b1",null);a=GetUrlParam("b2",null);d&&(this.effect2nd=d);a&&(this.effect3rd=a)};
SlotGrid.prototype.GenerateAssignment=function(){if(this.IsEmptyTree())return null;for(var a=[],b=0;b<this.Column[0].length;b++)for(var d=0;d<this.Column.length;d++)this.Column[d][b].IsEmpty||(this.Column[d][b].SkillInfo.ShortID?a.push(d+"-"+b+"-"+this.Column[d][b].SkillInfo.ShortID):a.push(d+"-"+b+"-"+this.Column[d][b].SkillInfo.GetID()));return a.join("_")};var clipboardsupport;function readurlparam(a){return decodeURIComponent(((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}function GetUrlParam(a,b){return(a=readurlparam(a))?a:b}function shownotify(a,b){$.notify({message:a},{type:b,placement:{from:"bottom",align:"right"},animate:{enter:"animated fadeInRight",exit:"animated fadeOutDown"}})}
function copyLink(a){if(window.clipboardsupport){var b=$("<div>").addClass("hiddendiv");a=$("<button>").addClass("btncopymagicclass").attr("data-clipboard-text",encodeURI(a));b.append(a);$("body").append(b);a.trigger("click");b.remove();return!0}b=$("<div>");b.append($("<p>").text("Clipboard access failed. Please copy the link below:"));b.append($("<input>").attr("type","text").css({width:"100%"}).prop("readonly",!0).val(a).click(function(){$(this).select()}));window.ShowMessageDialog(b);return!1}
function SetLoading(a){var b=a.find($("div[metroloading]"));b&&0<b.length||(b=$("<div>").addClass("stretch").addClass("windows8-loading"),b.append($("<b>")),b.append($("<b>")),b.append($("<b>")),b.append($("<b>")),b.append($("<b>")),b=$("<div metroloading>").addClass("midcenter").append(b),$("<div metroloading>").addClass("fixedDiv").addClass("stretch").addClass("disabled").addClass("opacity50").prependTo(a),a.append(b))}
function GetSvgUnavailable(){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 40 40" class="icon icons8-Unavailable"><g id="surface1"><path style="fill:#DFF0FE;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke:#4788C7;stroke-opacity:1;stroke-miterlimit:10;" d="M 20 1 C 9.507813 1 1 9.507813 1 20 C 1 30.492188 9.507813 39 20 39 C 30.492188 39 39 30.492188 39 20 C 39 9.507813 30.492188 1 20 1 Z M 6 20 C 6 12.269531 12.269531 6 20 6 C 22.964844 6 25.707031 6.925781 27.96875 8.496094 L 8.496094 27.96875 C 6.925781 25.707031 6 22.964844 6 20 Z M 20 34 C 17.035156 34 14.292969 33.074219 12.03125 31.503906 L 31.503906 12.03125 C 33.074219 14.292969 34 17.035156 34 20 C 34 27.730469 27.730469 34 20 34 Z"></path></g></svg>'}
function RemoveLoading(a){a.children("div[metroloading]").remove()}String.prototype.ctrim=function(a){void 0===a&&(a="s");return this.replace(new RegExp("^["+a+"]+"),"").replace(new RegExp("["+a+"]+$"),"")};function GetCurrentFolderUrl(){var a=location.pathname.split("/");a[a.length-1]?-1!=a[a.length-1].indexOf(".")&&a.pop():a.pop();return a[a.length-1]}function removefilename(a){}
$(function(){try{if(ClipboardJS.isSupported()){var a=new ClipboardJS(".btncopymagicclass");window.clipboardsupport=!0;a.on("success",function(a){window.shownotify("The link to this skill tree has been copied to clipboard.","success")});a.on("error",function(a){var b=$("<div>");b.append($("<p>").text("Clipboard access failed. Please copy the link below:"));b.append($("<input>").attr("type","text").css({width:"100%"}).prop("readonly",!0).val(a.text).click(function(){$(this).select()}));window.ShowMessageDialog(b)})}else window.clipboardsupport=
!1}catch(b){window.clipboardsupport=!1}});var c_maxlevel=60;function SkillTreeCore(){this._spleft=this._investedsp=this._currentlevel=this._totalsp=0;this.slotassign=new SlotGrid}SkillTreeCore.prototype.GetTotalSP=function(){return this._totalsp};SkillTreeCore.prototype.GetCurrentLevel=function(){return this._currentlevel};SkillTreeCore.prototype.GetInvestedSP=function(){return this._investedsp};SkillTreeCore.prototype.GetSPLeft=function(){return this._spleft};
SkillTreeCore.prototype.SetLevel=function(a){this._currentlevel=Math.min(a,window.c_maxlevel);this._totalsp=this.inner_gettotalsp(this._currentlevel);this.UpdateAllSPs()};SkillTreeCore.prototype.SetLevelFromElement=function(){this.SetLevel(parseInt($("#selectLevelBox").val()))};
SkillTreeCore.prototype.UpdateSP=function(){this._spleft=this._totalsp-this._investedsp;5>this._spleft?$("#e_remainingSP").addClass("alertlow"):$("#e_remainingSP").removeClass("alertlow");$("#e_investedSP").text("Invested SP: "+this._investedsp+"/"+this._totalsp);$("#e_remainingSP").text("Remaining SP: "+this._spleft+"/"+this._totalsp);$("#spusageinfo").html(this.GenerateUsageInfo())};
SkillTreeCore.prototype.UpdateAllSPs=function(){$("#e_investedSP").text("Invested SP: "+this._investedsp+"/"+this._totalsp);this.CheckAllSkills()&&(this._spleft=this._totalsp-this._investedsp,$("#e_remainingSP").text("Remaining SP: "+this._spleft+"/"+this._totalsp),this.CheckAllSkills(),5>this._spleft?$("#e_remainingSP").addClass("alertlow"):$("#e_remainingSP").removeClass("alertlow"));$("#spusageinfo").html(this.GenerateUsageInfo())};SkillTreeCore.prototype.UnlearnAllSkills=function(){for(var a in this.SkillList)this.SkillList[a].UnlearnSkill()};
SkillTreeCore.prototype.CheckAllSkills=function(){if(this._totalsp<this._investedsp){if(this.SkillList)for(var a in this.SkillList)this.SkillList[a].UnlearnSkill();return!1}if(!this.SkillList)return!1;for(a in this.SkillList){var b=this.SkillList[a];if(b.GetAvailableLevel()>this._currentlevel)b.UnlearnSkill();else{b.GetCurrentSkillLevel()<b.GetDefaultLevel()&&b.UnlearnSkill();var d=b.CurrentLevelInfo();d.RequiredLevel>this._currentlevel&&b.UnlearnSkill()}}return!0};
SkillTreeCore.prototype.inner_gettotalsp=function(a){for(var b=0,d=1;d<=a;d++)b+=this.inner_gettotalspex(d);return b};
SkillTreeCore.prototype.inner_gettotalspex=function(a){switch(a){case 0:return 0;case 1:return 0;case 2:return 0;case 3:return 0;case 4:return 1;case 5:return 3;case 6:return 1;case 7:return 1;case 8:return 1;case 9:return 1;case 10:return 5;case 15:return 5;case 20:return 10;case 25:return 5;case 30:return 5;case 35:return 5;case 40:return 10;case 45:return 5;case 50:return 5;case 55:return 5;case 60:return 5;default:return 2}};
SkillTreeCore.prototype.GenerateLink=function(a){var b=[];this._currentlevel!==window.c_maxlevel&&b.push("lv="+this._currentlevel);for(var d in this.SkillList){var c=this.SkillList[d].GetCurrentSkillLevel();c!=this.SkillList[d].GetDefaultLevel()&&(this.SkillList[d].ShortID?b.push(this.SkillList[d].ShortID+"="+c):b.push(d+"="+c))}d=location.protocol+"//"+location.host+location.pathname;c=null;var e=this.slotassign.GenerateAssignment();e&&b.push("s="+e);"2_1"!==this.slotassign.effect2nd&&b.push("b1="+
this.slotassign.effect2nd);"3_1"!==this.slotassign.effect3rd&&b.push("b2="+this.slotassign.effect3rd);!0===a&&b.push("sa=1");1<b.length?c=b.join("&"):1===b.length&&(c=b[0]);c&&(d=d+"?"+c);return d};
SkillTreeCore.prototype.GenerateUsageInfo=function(){var a={},b;for(b in this.SkillList)if(this.SkillList.hasOwnProperty(b)&&this.SkillList[b].GetCurrentSkillLevel()!=this.SkillList[b].GetDefaultLevel()){var d=this.SkillList[b].GetSPUsed();var c=this.SkillList[b].GetParent();0!=d&&(c?a[c.GetID()]+=" + "+d+"SP":a[b]=this.SkillList[b].GetName()+": "+d+"SP")}c="";d=!0;if(0<Object.keys(a).length)for(b in a)a.hasOwnProperty(b)&&(d?(c+=a[b],d=!1):c+="<br>"+a[b]);return c};
SkillTreeCore.prototype.ResetSlotAssignment=function(){this.slotassign.ResetToEmpty()};SkillTreeCore.prototype.SetSkillAssignment=function(a,b,d){this.slotassign.SetGridValue(a,b,d)};SkillTreeCore.prototype.GetSkillAssignmentRender=function(){return this.slotassign.GetRender()};SkillTreeCore.prototype.ReadAssignment=function(){this.slotassign.ReadAssignment()};var SkillCore=new SkillTreeCore,mouseX,mouseY;$(document).mousemove(function(a){window.mouseX=a.pageX;window.mouseY=a.pageY});
function SetToolTip(a){var b;a.mouseover(function(){var a=$(this).attr("insight");if(a){var c=window.SkillCore.GetSkill(a);if(a=c.GetCurrentLevelInfo()){var e=a.SkillDescription,f=a.SkillEffect;a=$("div#tooltip");var g=[];e&&(g.push("[Description]\n"),g.push(e));f&&(0!==g.length&&g.push("\n\n"),g.push("[Effect]\n"),g.push(f));$("div#tooltip .tooltipheader").text(c.GetName());0!==g?$("div#tooltip pre").text(g.join("")).show():$("div#tooltip pre").empty().hide();c={};b=$(".navbar.fixed-bottom").outerHeight(!0);
e=window.mouseY+10;e+a.outerHeight(!0)>$(document).height()-b?(c.bottom=b,c.top=""):(c.bottom="",c.top=e);e=window.mouseX+5;e+a.outerWidth(!0)>$(document).width()?(c.left="",c.right=0):(c.right="",c.left=e);a.css(c);a.stop(!1,!0).fadeIn("fast")}}}).mousemove(function(){var a=$("div#tooltip"),c={},e=window.mouseY+10;e+a.outerHeight(!0)>$(document).height()-b?(c.bottom=b,c.top=""):(c.bottom="",c.top=e);e=window.mouseX+5;e+a.outerWidth(!0)>$(document).width()?(c.left="",c.right=0):(c.right="",c.left=
e);a.css(c)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}
function SetToolTipUp(a){var b;a.mouseover(function(){var a=$(this).attr("insight");if(a){a=window.SkillCore.GetSkill(a);var c=a.GetCurrentLevelInfo(),e=a.GetNextLevelInfo();a=$("div#tooltip");if(c||e){c=c.SkillEffect;var f="";e&&(f=e.SkillEffect);c||f?(e=[],c&&(e.push("[Current]\n"),e.push(c)),f&&(0!==e.length&&e.push("\n\n"),e.push("[After]\n"),e.push(f)),0!==e.length?$("div#tooltip pre").text(e.join("")).show():$("div#tooltip pre").empty().hide(),e={},b=$(".navbar.fixed-bottom").outerHeight(!0),
c=window.mouseY+10,c+a.outerHeight(!0)>$(document).height()-b?(e.bottom=b,e.top=""):(e.bottom="",e.top=c),c=window.mouseX+5,c+a.outerWidth(!0)>$(document).width()?(e.left="",e.right=0):(e.right="",e.left=c),a.css(e),a.stop(!1,!0).fadeIn("fast")):a.stop(!1,!0).fadeOut("fast")}}}).mousemove(function(){var a=$("div#tooltip"),c={},e=window.mouseY+10;e+a.outerHeight(!0)>$(document).height()-b?(c.bottom=b,c.top=""):(c.bottom="",c.top=e);e=window.mouseX+5;e+a.outerWidth(!0)>$(document).width()?(c.left="",
c.right=0):(c.right="",c.left=e);a.css(c)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}
function SetToolTipDown(a){var b;a.mouseover(function(){var a=$(this).attr("insight");if(a){a=window.SkillCore.GetSkill(a);var c=a.GetCurrentLevelInfo(),e=a.GetPreviousLevelInfo();a=$("div#tooltip");if(c||e){c=c.SkillEffect;var f="";e&&(f=e.SkillEffect);c||f?(e=[],c&&(e.push("[Current]\n"),e.push(c)),f&&(0!==e.length&&e.push("\n\n"),e.push("[After]\n"),e.push(f)),0!==e.length?$("div#tooltip pre").text(e.join("")).show():$("div#tooltip pre").empty().hide(),e={},b=$(".navbar.fixed-bottom").outerHeight(!0),
c=window.mouseY+10,c+a.outerHeight(!0)>$(document).height()-b?(e.bottom=b,e.top=""):(e.bottom="",e.top=c),c=window.mouseX+5,c+a.outerWidth(!0)>$(document).width()?(e.left="",e.right=0):(e.right="",e.left=c),a.css(e),a.stop(!1,!0).fadeIn("fast")):a.stop(!1,!0).fadeOut("fast")}}}).mousemove(function(){var a=$("div#tooltip"),c={},e=window.mouseY+10;e+a.outerHeight(!0)>$(document).height()-b?(c.bottom=b,c.top=""):(c.bottom="",c.top=e);e=window.mouseX+5;e+a.outerWidth(!0)>$(document).width()?(c.left="",
c.right=0):(c.right="",c.left=e);a.css(c)}).mouseout(function(){$("div#tooltip").stop(!1,!0).fadeOut("fast")});return a}function ShowDangerDialog(a,b,d){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Warning",Bootstrap4ModalDialog.ButtonsYesNoDanger);a.RegisterCallback(function(a,e){e?"function"===typeof b&&b():"function"===typeof d&&d()});a.Show()}
function ShowMessageDialog(a,b){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Notice");a.RegisterCallback(function(a,c){c&&"function"===typeof b&&b()});a.Show()}function ShowConfirmDialog(a,b,d){a=new Bootstrap4ModalDialog($("#dialogs"),a,"Double confirmation",Bootstrap4ModalDialog.ButtonsYesNo);a.RegisterCallback(function(a,e){e?"function"===typeof b&&b():"function"===typeof d&&d()});a.Show()}
function ShowSkillAssignment(a){window.SkillCore&&(new Bootstrap4ModalDialog($("#dialogs"),window.SkillCore.GetSkillAssignmentRender(),"Skill slot assignment",[{label:"Reset",cssClass:"btn btn-warning",action:function(a){window.ShowDangerDialog("Are you sure you want to reset all the slot assignments?",function(){window.SkillCore.ResetSlotAssignment()})}},{label:"Close",cssClass:"btn btn-default",action:function(b){b.Hide();"function"===typeof a&&a()}}])).Show()}
$(function(){$("#dialogs").hide().click(function(a){a.preventDefault();window.DialogManager.CloseForegroundDialog()});window.DialogManager.OnModalChanged(function(a){a?$("#dialogs").show():$("#dialogs").hide()});SetLoading($("body"));for(var a=$('<select id="selectLevelBox">').change(function(){window.SkillCore.SetLevel($(this).val())}),b=1;b<=window.c_maxlevel;b++)a.append($("<option>").val(b).text(b));$("#levelBoxtd").append(a);b=GetUrlParam("lv",60);60==b&&(b=GetUrlParam("level",60));isNaN(b)&&
(b=60);a.val(b);a.trigger("change");$('#charList a[href^="../'+GetCurrentFolderUrl()+'"]').remove();$("#copyURL").click(function(a){a.preventDefault();(a=window.SkillCore.GenerateLink())&&copyLink(a)});$("#copyURLshowassign").click(function(a){a.preventDefault();(a=window.SkillCore.GenerateLink(!0))&&copyLink(a)});$("#resetAllSkill").click(function(){ShowDangerDialog("Are you sure you want to unlearn all skills?",function(){window.SkillCore.UnlearnAllSkills()})});$("#slotassignment").click(function(){ShowSkillAssignment()});
var d=GetUrlParam("sa",null);window.SkillCore.ReadTree(function(a){if(a.Cover&&a.Cover.URL){var b=a.Cover.Position?a.Cover.Position:"side-right";$("#forbackground").append($("<img>").addClass(["image-bg-character",b]).attr("src",a.Cover.URL).imagesLoaded().always(function(a){a.elements.forEach(function(a,b,c){$(a).addClass("animated fadeIn").show()})}).hide())}},function(){RemoveLoading($("body"));window.SkillCore.ReadAssignment();"1"===d&&$("#slotassignment").click()})});function SkillInfo(a,b,d){this._rowspan=1;this._defaultLevel=0;this._id=a;this._availablelevel=window.c_maxlevel+1;this._currentskilllevel=0;this._name=b;this._passive=!1;this._parent=null;this._visible=!0;this._spused=0;this.Assignable=!0;this.readInfos(d)}
SkillInfo.prototype.readInfos=function(a){this.Levels=[];var b="",d;for(d in a.Levels)a.Levels[d].Description&&(b=a.Levels[d].Description),this.Levels.push(new LevelInfo(a.Levels[d].RequiredLevel,a.Levels[d].RequiredSP,a.Levels[d].Effect,b));this._string_extensions=a.Extensions;a.Passive&&(this._passive=a.Passive);this._iconURL=a.Icon;0==a.Assignable&&(this.Assignable=a.Assignable);0==a.Visible&&(this._visible=a.Visible);this._skillmaxlevel=this.Levels.length-1;0<a.DefaultLevel&&(this._defaultLevel=
a.DefaultLevel);this._availablelevel=this.Levels[1].RequiredLevel;a.ID&&(this.ShortID=a.ID);0<a.RowSpan&&(this._rowspan=a.RowSpan);this.SetCurrentSkillLevel(this._defaultLevel);this._availablelevel<=window.SkillCore.GetCurrentLevel()?(a=GetUrlParam(this._id,null),!a&&this.ShortID&&(a=GetUrlParam(this.ShortID,null)),a||(a=this._defaultLevel),this.SetCurrentSkillLevel(a)):this.SetCurrentSkillLevel(0)};SkillInfo.prototype.SetParent=function(a){this._parent=a};SkillInfo.prototype.GetParent=function(){return this._parent};
SkillInfo.prototype.GetID=function(){return this._id};SkillInfo.prototype.GetName=function(){return this._name};SkillInfo.prototype.GetAvailableLevel=function(){return this._availablelevel};SkillInfo.prototype.GetSPUsed=function(){return this._spused};SkillInfo.prototype.GetCurrentSkillLevel=function(){return this._currentskilllevel};SkillInfo.prototype.GetMaxLevel=function(){return this._skillmaxlevel};SkillInfo.prototype.GetCurrentLevelInfo=function(){return this.Levels[this._currentskilllevel]};
SkillInfo.prototype.GetIconURL=function(){return this._iconURL};SkillInfo.prototype.IsPassive=function(){return this._passive};SkillInfo.prototype.GetDefaultLevel=function(){return this._defaultLevel};SkillInfo.prototype.IsAssignable=function(){return this.Assignable};SkillInfo.prototype.GetRowSpan=function(){return this._rowspan};SkillInfo.prototype.GetNextLevelInfo=function(){return this.Levels[this._currentskilllevel+1]};
SkillInfo.prototype.GetPreviousLevelInfo=function(){return this.Levels[this._currentskilllevel-1]};SkillInfo.prototype.GetExtensions=function(){if(!this._extensions){this._extensions={};var a;for(a in this._string_extensions){var b=this._string_extensions[a];var d=window.SkillCore.GetSkill(b);d.SetParent(this);this._extensions[b]=d}}return this._extensions};SkillInfo.prototype.IsVisible=function(){return this._visible};
SkillInfo.prototype.UnlearnSkill=function(){this._availablelevel>window.SkillCore.GetCurrentLevel()?this.SetCurrentSkillLevel(0):this.ToDefaultLevel()};SkillInfo.prototype.ToDefaultLevel=function(){this.SetCurrentSkillLevel(Math.max(0,this._defaultLevel))};SkillInfo.prototype.SetCurrentSkillLevel=function(a){for(var b=0;b<=this._skillmaxlevel&&(this._currentskilllevel>a&&this.SkillDownEx(),this._currentskilllevel<a&&this.SkillUp(),this._currentskilllevel!=a);b++);};
function LevelInfo(a,b,d,c){this.RequiredLevel=a;this.RequiredSP=b;this.SkillDescription=c;this.SkillEffect=d};SkillTreeCore.prototype.ReadTree=function(a,b){this.SkillList={};this.ActiveSkillList={};this.PassiveSkillList={};this.loadedSkillCount=this.SkillCount=0;$.ajax({cache:!1,url:"skilltreeinfo.json",dataType:"json",success:function(d){d.CharacterName?$("#charName").text(d.CharacterName):$("#charName").text(GetCurrentFolderUrl());d.CharacterWikiURL?d.CharacterName?$("#morecharacterinfo").attr("href",d.CharacterWikiURL).attr("target","_blank").text("More info about "+d.CharacterName):$("#morecharacterinfo").attr("href",
d.CharacterWikiURL).attr("target","_blank").text("More info about "+GetCurrentFolderUrl()):$("#morecharacterinfo").remove();window.document.title="Skill Simulator - "+d.CharacterName;for(var c in d.Skills)d.Skills.hasOwnProperty(c)&&(window.SkillCore.SkillList[c]=new SkillInfo(c,d.Skills[c].Name,d.Skills[c]),window.SkillCore.SkillList[c].IsPassive()?window.SkillCore.PassiveSkillList[c]=window.SkillCore.SkillList[c]:window.SkillCore.ActiveSkillList[c]=window.SkillCore.SkillList[c]);window.SkillCore.SkillCount=
Object.keys(window.SkillCore.SkillList).length;"function"===typeof a&&a(d);window.SkillCore.RenderTree(b)}})};SkillTreeCore.prototype.GetSkill=function(a){return this.SkillList[a]};SkillTreeCore.prototype.GetSkillByShortID=function(a){for(var b in this.SkillList)if(this.SkillList.hasOwnProperty(b)&&this.SkillList[b].ShortID&&this.SkillList[b].ShortID==a)return this.SkillList[b];return null};
SkillTreeCore.prototype.RenderTree=function(a){var b=$("li#activeskill");if(b){var d=$("<ul>").addClass("tableactiveskill");b.empty();var c=0,e;for(e in this.ActiveSkillList)this.ActiveSkillList[e].IsVisible()&&(1<this.ActiveSkillList[e].GetRowSpan()?c+=this.ActiveSkillList[e].GetRowSpan():c++,d.append($("<li>").addClass("tablelike").append(this.ActiveSkillList[e].GetSkillPanel())),3<=c&&(d&&b.append(d),d=$("<ul>").addClass("tableactiveskill"),c=0));0<c&&d&&b.append(d)}if(b=$("li#passiveskill")){d=
$("<ul>").addClass("tablepassiveskill");b.empty();c=0;for(e in this.PassiveSkillList)this.PassiveSkillList[e].IsVisible()&&(1<this.PassiveSkillList[e].GetRowSpan()?c+=this.PassiveSkillList[e].GetRowSpan():c++,d.append($("<li>").addClass("tablelike").addClass("passiveskilltree").append(this.PassiveSkillList[e].GetSkillPanel())),2<=c&&(d&&b.append(d),d=$("<ul>").addClass("tablepassiveskill"),c=0));0<c&&d&&b.append(d)}"function"===typeof a&&$("#skilltree").imagesLoaded().always(function(){a()})};
SkillInfo.prototype.GetSkillPanel=function(a){if(this.Panel)return this.Panel;if(a){a=$("<div>").addClass("skillExinfopanel").addClass("fadeinAppear");a.attr("insight",this._id);a.css({top:""});var b=$("<img>").addClass("skillExIcon").attr("insight",this._id).attr("src",this.GetIconURL());a.append(b);SetToolTip(b);b=$('<button type="button" class="btn-success skillexup" insight="'+this._id+'">').attr("skillup","1");this._currentskilllevel===this._skillmaxlevel&&b.addClass("disabled");SetToolTipUp(b);
a.append(b.click(function(){$(this).hasClass("disabled")||(window.SkillCore.GetSkill($(this).attr("insight")).SkillUp(),$(this).trigger("mouseover"))}));b=$('<button type="button" class="btn-danger skillexdown" insight="'+this._id+'">').attr("skilldown","1");this._currentskilllevel===this._defaultLevel&&b.addClass("disabled");SetToolTipDown(b);a.append(b.click(function(){$(this).hasClass("disabled")||(window.SkillCore.GetSkill($(this).attr("insight")).SkillDown(),$(this).trigger("mouseover"))}));
a.append($('<p insight="skilllexevel">').addClass("skillExLevel").text(this._currentskilllevel+""+this._skillmaxlevel));b=this.GetExtensions();if(void 0!==b&&0<Object.keys(b).length){var d;for(d in b){var c=window.SkillCore.GetSkill(d);c.GetSkillPanel(!0).appendTo(a)}}}else if(a=$("<div>").addClass("skillinfopanel").addClass("fadeinAppear"),a.attr("insight",this._id),b=$("<img>").addClass("skillIcon").attr("insight",this._id).attr("src",this.GetIconURL()),a.append(b),SetToolTip(b),b=$('<button type="button" class="btn btn-success skillup" insight="'+
this._id+'">').attr("skillup","1"),this._currentskilllevel===this._skillmaxlevel&&b.addClass("disabled"),SetToolTipUp(b),a.append(b.click(function(){window.SkillCore.GetSkill($(this).attr("insight")).SkillUp();$(this).trigger("mouseover")})),b=$('<button type="button" class="btn btn-danger skilldown" insight="'+this._id+'">').attr("skilldown","1"),this._currentskilllevel===this._defaultLevel&&b.addClass("disabled"),SetToolTipDown(b),a.append(b.click(function(){window.SkillCore.GetSkill($(this).attr("insight")).SkillDown();
$(this).trigger("mouseover")})),a.append($('<p insight="skilllevel">').addClass("skillLevel").text(this._currentskilllevel+"/"+this._skillmaxlevel)),b=this.GetExtensions(),void 0!==b&&0<Object.keys(b).length){var e=!1,f=0;for(d in b){f++;var g=$("<div>").addClass("extension"+f+"infopanel");c=window.SkillCore.GetSkill(d);c.GetSkillPanel(!0).appendTo(g);this._currentskilllevel<this._skillmaxlevel?c.Disabled(!0):0<c.GetCurrentSkillLevel()?(c.Disabled(!1),e=!0):c.Disabled(!0);g.appendTo(a)}if(!e&&this._currentskilllevel==
this._skillmaxlevel)for(d in b)window.SkillCore.GetSkill(d).Disabled(!1)}return this.Panel=a};
SkillInfo.prototype.Disabled=function(a){a?(this.UnlearnSkill(),a=this.GetSkillPanel(),a.hasClass("disabled")||a.addClass("disabled"),a.find("button[skilldown]:not(.disabled)").addClass("disabled"),a.find("button[skillup]:not(.disabled)").addClass("disabled"),a.find("img:not(.disabled)").addClass("disabled")):(a=this.GetSkillPanel(),a.hasClass("disabled")&&a.removeClass("disabled"),a.find("img.disabled").removeClass("disabled"),a.find("button.disabled[skilldown]").removeClass("disabled"),a.find("button.disabled[skillup]").removeClass("disabled"))};
SkillInfo.prototype.UpdateSkill=function(){if(this.Panel){var a=this.Panel;a.children('p[insight="skilllevel"]:first').text(this._currentskilllevel+"/"+this._skillmaxlevel);a.children('p[insight="skilllexevel"]:first').text(this._currentskilllevel+""+this._skillmaxlevel);if(this._currentskilllevel<=this._defaultLevel){if(a.children("button[skilldown]:first").addClass("disabled"),(a=this._parent)&&!a.GetNextLevelInfo()){a=a.GetExtensions();for(var b in a)a[b].Disabled(!1)}}else if(this._currentskilllevel==
this._skillmaxlevel){a.children("button[skillup]:first").addClass("disabled");if(a=this._parent)for(b in a=a.GetExtensions(),a){var d=a[b];d.GetID()!==this._id&&d.Disabled(!0)}a=this.GetExtensions();for(b in a)a[b].Disabled(!1)}else{a.children("button.disabled[skilldown]:first").removeClass("disabled");a.children("button.disabled[skillup]:first").removeClass("disabled");if(a=this._parent)for(b in a=a.GetExtensions(),a)d=a[b],d.GetID()!==this._id&&d.Disabled(!0);a=this.GetExtensions();for(b in a)a[b].Disabled(!0)}}};
SkillInfo.prototype.SkillUp=function(){var a=this.GetNextLevelInfo();a&&(a.RequiredLevel>window.SkillCore.GetCurrentLevel()?shownotify("Character level is not enough to learn further.","info"):(a=a.RequiredSP,window.SkillCore.GetSPLeft()<a?shownotify("Insufficient skill point.","info"):(this._currentskilllevel++,this._spused+=a,window.SkillCore.InvestedSPIncrease(a),this.UpdateSkill())))};
SkillInfo.prototype.SkillDown=function(){if(this.GetPreviousLevelInfo())if(this._defaultLevel===this._currentskilllevel)shownotify("Can not go lower than skill's default level.","warning");else{var a=this.GetCurrentLevelInfo().RequiredSP;this._spused-=a;window.SkillCore.InvestedSPDecrease(a);this._currentskilllevel--;this.UpdateSkill()}};
SkillInfo.prototype.SkillDownEx=function(){this.GetPreviousLevelInfo()&&(window.SkillCore.InvestedSPDecrease(this.GetCurrentLevelInfo().RequiredSP),this._currentskilllevel--,this.UpdateSkill())};SkillTreeCore.prototype.InvestedSPIncrease=function(a){this._investedsp+=a;this.UpdateSP()};SkillTreeCore.prototype.InvestedSPDecrease=function(a){this._investedsp-=a;this.UpdateSP()};
